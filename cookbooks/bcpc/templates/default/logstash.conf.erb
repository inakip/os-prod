################################################
#
#              Generated by Chef
#
################################################

input {
    amqp {
        host => "<%="#{node[:bcpc][:management][:vip]}"%>"
        password => "<%="#{get_config('rabbitmq-password')}"%>"
        exchange => 'logstash-exchange'
        queue => 'logstash-queue'
        key => 'logstash-key'
        type => 'direct'
        auto_delete => false
        exclusive => false
        durable => true
    }
}

filter {
    grok {
        type => "apache-access"
        pattern => "%{COMBINEDAPACHELOG}"
    }
    date {
        type => "apache-access"
        timestamp => "dd/MMM/yyyy:HH:mm:ss Z"
    }
    grok {
        type => "syslog"
        pattern => "%{SYSLOGBASE} %{GREEDYDATA:message}"
    }
    multiline {
        type => "rabbitmq"
        pattern => "^="
        negate => true
        what => "previous"
    }
    multiline {
        pattern => "^$"
        what => "previous"
    }
}

output { 
    # stdout { 
    #    debug => true
    # }
    elasticsearch_http {
        host => "<%="#{node[:bcpc][:management][:vip]}"%>"
    }
}
